™
1/Users/mgilyass/Desktop/readit/cart/BookLoader.cs
	namespace 	
cart
 
{ 
public 

class 

BookLoader 
{		 
public

 
static

 
void

 
	LoadBooks

 $
(

$ %
BookContext

% 0
ctx

1 4
)

4 5
{ 	
ctx 
. 
Books 
. 
RemoveRange !
(! "
ctx" %
.% &
Books& +
)+ ,
;, -
var 
books 
= 
new 
List  
<  !
Book! %
>% &
{ 
new 
Book 
{ 
Name 
= 
$str '
,' (
Author) /
=/ 0
$str0 A
,A B
PagesC H
=H I
$numI L
,L M
ImageUrlM U
=U V
$strV `
,` a
InStockb i
=i j
$numj l
,l m
Pricen s
=s t
$numt y
}z {
,{ |
new 
Book 
{ 
Name 
= 
$str *
,* +
Author, 2
=2 3
$str3 ?
,? @
PagesA F
=F G
$numG J
,J K
ImageUrlK S
=S T
$strT d
,d e
InStockf m
=m n
$numn p
,p q
Pricer w
=w x
$numx }
}~ 
,	 Ä
new 
Book 
{ 
Name 
= 
$str /
,/ 0
Author1 7
=7 8
$str8 I
,I J
PagesK P
=P Q
$numQ T
,T U
ImageUrlU ]
=] ^
$str^ k
,k l
InStockm t
=t u
$numu w
,w x
Pricey ~
=~ 
$num	 Ñ
}
Ö Ü
,
Ü á
new 
Book 
{ 
Name 
= 
$str *
,* +
Author, 2
=2 3
$str3 B
,B C
PagesD I
=I J
$numJ M
,M N
ImageUrlN V
=V W
$strW b
,b c
InStockd k
=k l
$numl n
,n o
Pricep u
=u v
$numv {
}| }
} 
; 
ctx 
. 
Books 
. 
AddRange 
( 
books $
)$ %
;% &
ctx 
. 
SaveChanges 
( 
) 
; 
System 
. 
Console 
. 
	WriteLine $
($ %
$"% '
$str' .
{. /
ctx/ 2
.2 3
Books3 8
.8 9
Count9 >
(> ?
)? @
}@ A
$strA G
"G H
)H I
;I J
} 	
} 
}   é
7/Users/mgilyass/Desktop/readit/cart/Data/BookContext.cs
	namespace 	
cart
 
. 
Data 
{ 
public 

class 
BookContext 
: 
	DbContext (
{ 
public 
BookContext 
( 
DbContextOptions +
<+ ,
BookContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
{R S
}T U
public

 
DbSet

 
<

 
Book

 
>

 
Books

  
{

" #
get

# &
;

& '
set

( +
;

+ ,
}

, -
} 
} Á
N/Users/mgilyass/Desktop/readit/cart/Migrations/20201104153420_InitialCreate.cs
	namespace 	
cart
 
. 

Migrations 
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 
,

 
columns 
: 
table 
=> !
new" %
{ 
ID 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
nullable0 8
:8 9
true: >
)> ?
,? @
Pages 
= 
table !
.! "
Column" (
<( )
int) ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
Author 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
nullable2 :
:: ;
true< @
)@ A
,A B
ImageUrl 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
nullable4 <
:< =
true> B
)B C
,C D
Price 
= 
table !
.! "
Column" (
<( )
double) /
>/ 0
(0 1
nullable1 9
:9 :
false; @
)@ A
,A B
InStock 
= 
table #
.# $
Column$ *
<* +
int+ .
>. /
(/ 0
nullable0 8
:8 9
false: ?
)? @
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
ID8 :
): ;
;; <
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
; 
}   	
}!! 
}"" ô

2/Users/mgilyass/Desktop/readit/cart/Models/Book.cs
	namespace 	
cart
 
. 
Models 
{ 
public 

class 
Book 
{ 
public 
int 
ID 
{ 
get 
; 
set  
;  !
}! "
public 
String 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
Pages 
{ 
get 
; 
set  #
;# $
}% &
public		 
String		 
Author		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 
String

 
ImageUrl

 
{

  !
get

! $
;

$ %
set

& )
;

) *
}

* +
public 
double 
Price 
{ 
get !
;! "
set# &
;& '
}' (
public 
int 
InStock 
{ 
get  
;  !
set" %
;% &
}& '
} 
} ’S
9/Users/mgilyass/Desktop/readit/cart/Pages/Index.cshtml.cs
	namespace 	
cart
 
. 
Pages 
{ 
public 

class 

IndexModel 
: 
	PageModel '
{ 
private 
readonly 
ILogger  
<  !

IndexModel! +
>+ ,
_logger- 4
;4 5
private 
readonly 
BookContext $
_context% -
;- .
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 

IndexModel 
( 
ILogger !
<! "

IndexModel" ,
>, -
logger. 4
,4 5
IConfiguration6 D
configE K
,L M
BookContextN Y
contextZ a
)a b
{ 	
_logger 
= 
logger 
; 
_context 
= 
context 
; 
_config 
= 
config 
; 
} 	
public 
void 
OnGet 
( 
) 
{   	
List"" 
<"" 
Book"" 
>"" 
books"" 
="" 
new""  
List""! %
<""% &
Book""& *
>""* +
(""+ ,
)"", -
;""- .
ViewData'' 
['' 
$str'' 
]'' 
='' 
books'' #
;''# $
}(( 	
public** 
IActionResult** (
OnPostRemoveFromShoppingCart** 9
(**9 :
)**: ;
{**= >
var++ 
bookId++ 
=++ 
int++ 
.++ 
Parse++  
(++  !
Request++! (
.++( )
Form++) -
[++- .
$str++. 6
]++6 7
)++7 8
;++8 9
var,, 
book,, 
=,, 
_context,, 
.,, 
Books,, #
.,,# $
Find,,$ (
(,,( )
bookId,,) /
),,/ 0
;,,0 1
book-- 
.-- 
InStock-- 
++-- 
;-- 
_context.. 
... 
SaveChanges..  
(..  !
)..! "
;.." #
var00 
client00 
=00 
GetRedisClient00 %
(00% &
)00& '
;00' (
client11 
.11 
RemoveItemFromList11 %
(11% &
$str11& ,
,11, -
bookId11. 4
.114 5
ToString115 =
(11= >
)11> ?
)11? @
;11@ A
return33 
RedirectToPage33 !
(33! "
)33" #
;33# $
}44 	
public66 
void66 
OnPostPlaceOrder66 $
(66$ %
)66% &
{66( )
var88 
booksInCart88 
=88 "
GetBooksInShoppingCart88 2
(882 3
)883 4
;884 5
var99 
order99 
=99 
new99 
Order99 
(99  
)99  !
;99! "
double:: 
total:: 
=:: 
$num:: 
;:: 
order;; 
.;; 
	orderDate;; 
=;; 
DateTime;; $
.;;$ %
Now;;% (
;;;( )
order<< 
.<< 
priority<< 
=<< 
$num<< 
;<< 
order== 
.== 
items== 
=== 
new== 
List==  
<==  !
	OrderItem==! *
>==* +
(==+ ,
)==, -
;==- .
foreach?? 
(?? 
var?? 
book?? 
in??  
booksInCart??! ,
)??, -
{??/ 0
var@@ 
item@@ 
=@@ 
new@@ 
	OrderItem@@ &
(@@& '
)@@' (
;@@( )
itemAA 
.AA 
nameAA 
=AA 
bookAA 
.AA 
NameAA #
;AA# $
itemBB 
.BB 
idBB 
=BB 
bookBB 
.BB 
IDBB 
;BB  
itemCC 
.CC 
priceCC 
=CC 
bookCC 
.CC  
PriceCC  %
;CC% &
totalDD 
+=DD 
itemDD 
.DD 
priceDD !
;DD! "
orderEE 
.EE 
itemsEE 
.EE 
AddEE 
(EE  
itemEE  $
)EE$ %
;EE% &
}FF 
orderHH 
.HH 
totalHH 
=HH 
totalHH 
;HH 
varJJ 
jsonJJ 
=JJ 
JsonConvertJJ  
.JJ  !
SerializeObjectJJ! 0
(JJ0 1
orderJJ1 6
)JJ6 7
;JJ7 8
ConsoleLL 
.LL 
	WriteLineLL 
(LL 
jsonLL "
)LL" #
;LL# $
tryNN 
{NN 
varOO 
clientOO 
=OO 
newOO 

HttpClientOO %
(OO% &
)OO& '
;OO' (
varPP 
resultPP 
=PP 
clientPP 
.PP 
	PostAsyncPP '
(PP' (
_configPP( /
.PP/ 0
GetValuePP0 8
<PP8 9
StringPP9 ?
>PP? @
(PP@ A
$strPPA S
)PPS T
,PPT U
newPPU X
StringContentPPY f
(PPf g
jsonPPg k
)PPk l
)PPl m
.PPm n
ResultPPn t
;PPt u
ConsoleRR 
.RR 
	WriteLineRR 
(RR 
$strRR 3
+RR4 5
resultRR6 <
)RR< =
;RR= >
ifTT 
(TT 
resultTT 
.TT 

StatusCodeTT !
==TT! #
SystemTT# )
.TT) *
NetTT* -
.TT- .
HttpStatusCodeTT. <
.TT< =
	NoContentTT= F
)TTF G
{TTI J
	ClearCartUU 
(UU 
)UU 
;UU 
}VV 
ViewDataXX 
[XX 
$strXX 
]XX 
=XX 
newXX !
ListXX" &
<XX& '
BookXX' +
>XX+ ,
(XX, -
)XX- .
;XX. /
ViewDataYY 
[YY 
$strYY "
]YY" #
=YY# $
$strYY$ *
;YY* +
}ZZ 
catch[[ 
([[ 
	Exception[[ 
ex[[ 
)[[  
{[[" #
ViewData\\ 
[\\ 
$str\\ &
]\\& '
=\\' (
$str\\( ?
+\\@ A
ex\\B D
.\\D E
Message\\E L
;\\L M
}]] 
}^^ 	
private`` 
List`` 
<`` 
Book`` 
>`` "
GetBooksInShoppingCart`` 1
(``1 2
)``2 3
{``5 6
varbb 
clientbb 
=bb 
GetRedisClientbb %
(bb% &
)bb& '
;bb' (
varcc 
bookIDscc 
=cc 
clientcc 
.cc 
GetAllItemsFromListcc 2
(cc2 3
$strcc3 9
)cc9 :
;cc: ;
returnee 
_contextee 
.ee 
Booksee !
.ee! "
Whereee" '
(ee' (
bee( )
=>ee) +
bookIDsee+ 2
.ee2 3
Containsee3 ;
(ee; <
bee< =
.ee= >
IDee> @
.ee@ A
ToStringeeA I
(eeI J
)eeJ K
)eeK L
)eeL M
.eeM N
ToListeeN T
(eeT U
)eeU V
;eeV W
}ff 	
privatehh 
voidhh 
	ClearCarthh 
(hh 
)hh  
{hh" #
varjj 
clientjj 
=jj 
GetRedisClientjj %
(jj% &
)jj& '
;jj' (
clientkk 
.kk 
RemoveAllFromListkk $
(kk$ %
$strkk% +
)kk+ ,
;kk, -
}ll 	
privatenn 
IRedisClientnn 
GetRedisClientnn +
(nn+ ,
)nn, -
{oo 	
varpp 
	conStringpp 
=pp 
_configpp #
.pp# $
GetValuepp$ ,
<pp, -
Stringpp- 3
>pp3 4
(pp4 5
$strpp5 M
)ppM N
;ppN O
varqq 
managerqq 
=qq 
newqq 
RedisManagerPoolqq .
(qq. /
	conStringqq/ 8
)qq8 9
;qq9 :
returnrr 
managerrr 
.rr 
	GetClientrr $
(rr$ %
)rr% &
;rr& '
}ss 	
}tt 
classvv 	
Ordervv
 
{vv 
publicww 
intww 
orderIdww 
{ww 
getww  
;ww  !
setww" %
;ww% &
}ww& '
publicxx 
DateTimexx 
	orderDatexx !
{xx# $
getxx$ '
;xx' (
setxx) ,
;xx, -
}xx- .
publicyy 
doubleyy 
totalyy 
{yy 
getyy !
;yy! "
setyy# &
;yy& '
}yy( )
publiczz 
intzz 
priorityzz 
{zz 
getzz !
;zz! "
setzz# &
;zz& '
}zz' (
public{{ 
List{{ 
<{{ 
	OrderItem{{ 
>{{ 
items{{ $
{{{% &
get{{' *
;{{* +
set{{, /
;{{/ 0
}{{1 2
public}} 
Order}} 
(}} 
)}} 
{~~ 	
orderId 
= 
new 
Random 
( 
)  
.  !
Next! %
(% &
$num& *
)* +
;+ ,
}
ÄÄ 	
}
ÅÅ 
class
ÉÉ 	
	OrderItem
ÉÉ
 
{
ÉÉ 
public
ÑÑ 
String
ÑÑ 
name
ÑÑ 
{
ÑÑ 
get
ÑÑ  
;
ÑÑ  !
set
ÑÑ" %
;
ÑÑ% &
}
ÑÑ' (
public
ÖÖ 
int
ÖÖ 
id
ÖÖ 
{
ÖÖ 
get
ÖÖ 
;
ÖÖ 
set
ÖÖ  
;
ÖÖ  !
}
ÖÖ" #
public
ÜÜ 
double
ÜÜ 
price
ÜÜ 
{
ÜÜ 
get
ÜÜ !
;
ÜÜ! "
set
ÜÜ# &
;
ÜÜ& '
}
ÜÜ( )
}
áá 
}àà Ä

./Users/mgilyass/Desktop/readit/cart/Program.cs
	namespace

 	
cart


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} Ä
./Users/mgilyass/Desktop/readit/cart/Startup.cs
	namespace		 	
cart		
 
{

 
public 

class 
Startup 
{ 
private 
bool 
useInMemory  
=! "
false# (
;( )
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddRazorPages "
(" #
)# $
;$ %
if 
( 
useInMemory 
) 
{ 
services 
. 
AddDbContext %
<% &
BookContext& 1
>1 2
(2 3
options3 :
=>; =
options> E
.E F
UseInMemoryDatabaseF Y
(Y Z
databaseNameZ f
:f g
$strh n
)n o
)o p
;p q
} 
else   
{!! 
services"" 
."" 
AddDbContext"" %
<""% &
BookContext""& 1
>""1 2
(""2 3
options""3 :
=>""; =
options""> E
.""E F
UseSqlServer""F R
(""R S
Configuration""S `
.""` a
GetConnectionString""a t
(""t u
$str""u ~
)""~ 
)	"" Ä
)
""Ä Å
;
""Å Ç
}## 
}$$ 	
public'' 
void'' 
	Configure'' 
('' 
IApplicationBuilder'' 1
app''2 5
,''5 6
IWebHostEnvironment''7 J
env''K N
)''N O
{(( 	
if)) 
()) 
env)) 
.)) 
IsDevelopment)) !
())! "
)))" #
)))# $
{** 
app++ 
.++ %
UseDeveloperExceptionPage++ -
(++- .
)++. /
;++/ 0
},, 
else-- 
{.. 
app// 
.// 
UseExceptionHandler// '
(//' (
$str//( 0
)//0 1
;//1 2
}22 
app55 
.55 
UseStaticFiles55 
(55 
)55  
;55  !
app77 
.77 

UseRouting77 
(77 
)77 
;77 
app99 
.99 
UseAuthorization99  
(99  !
)99! "
;99" #
app;; 
.;; 
UseEndpoints;; 
(;; 
	endpoints;; &
=>;;' )
{<< 
	endpoints== 
.== 
MapRazorPages== '
(==' (
)==( )
;==) *
}>> 
)>> 
;>> 
}?? 	
}@@ 
}AA 